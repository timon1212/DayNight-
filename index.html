<!DOCTYPE html>
<html>
<head>
  <title>Offline Dashboard Login</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>Offline Dashboard Login</header>
<div class="content">
  <h2>Login</h2>
  <input id="loginUser" placeholder="Username"><br>
  <input id="loginPass" type="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
  <p>New? <a href="#" id="showRegister">Register</a></p>

  <div id="registerSection" style="display:none;">
    <h2>Register</h2>
    <input id="regUser" placeholder="Username"><br>
    <input id="regPass" type="password" placeholder="Password"><br>
    <button id="registerBtn">Create Account</button>
  </div>
</div>

<script src="app.js"></script>
<script>
(async function() {
  // Make sure DB exists before any login/registration
  await initDB();
  await initDefaults();

  const loginBtn = document.getElementById("loginBtn");
  const regBtn = document.getElementById("registerBtn");

  loginBtn.onclick = async ()=>{
    const u = document.getElementById("loginUser").value;
    const p = document.getElementById("loginPass").value;
    const users = await getAll("users");
    const found = users.find(x => x.username === u && x.password === p);
    if(!found){ alert("Invalid login"); return; }
    localStorage.setItem("currentUser", JSON.stringify(found));
    window.location.href = "routes.html";
  };

  document.getElementById("showRegister").onclick = ()=>document.getElementById("registerSection").style.display="block";

  regBtn.onclick = async ()=>{
    const u = document.getElementById("regUser").value;
    const p = document.getElementById("regPass").value;
    if(!u || !p){ alert("Enter username & password"); return; }
    const users = await getAll("users");
    if(users.find(x => x.username === u)){ alert("Username exists"); return; }
    await addData("users", { username: u, password: p, role:"user" });
    alert("Account created, login now");
  };
})();
</script>
</html>
