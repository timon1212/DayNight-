<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DayNight Vending</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    /* Login Page Styles */
    #loginPage {
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      background: linear-gradient(135deg,#1e3c72,#2a5298);
      font-family: Arial, sans-serif;
    }
    #loginBox {
      background:white;
      padding:30px;
      border-radius:10px;
      width:300px;
      box-shadow:0 8px 16px rgba(0,0,0,0.3);
      text-align:center;
    }
    #loginBox h2 {
      margin-bottom:20px;
      color:#333;
    }
    #loginBox input {
      width:90%;
      padding:10px;
      margin:10px 0;
      border:1px solid #ccc;
      border-radius:5px;
      font-size:16px;
    }
    #loginBox button {
      width:95%;
      padding:10px;
      margin-top:10px;
      background:#2a5298;
      border:none;
      color:white;
      font-size:16px;
      border-radius:5px;
      cursor:pointer;
    }
    #loginBox button:hover{
      background:#1e3c72;
    }
    #loginBox small {
      display:block;
      margin-top:10px;
      color:#555;
      cursor:pointer;
      text-decoration:underline;
    }
  </style>
</head>
<body>
  <!-- LOGIN PAGE -->
  <div id="loginPage">
    <div id="loginBox">
      <h2>DayNight Vending</h2>
      <input type="text" id="loginUsername" placeholder="Username">
      <input type="password" id="loginPassword" placeholder="Password">
      <button onclick="login()">Login</button>
      <small onclick="showRegister()">Create Account</small>

      <div id="registerFields" style="display:none; margin-top:10px;">
        <input type="text" id="regUsername" placeholder="Username">
        <input type="password" id="regPassword" placeholder="Password">
        <button onclick="register()">Register</button>
        <small onclick="showLogin()">Back to Login</small>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="mainApp" style="display:none;">
    <header>
      <img src="assets/logo.png" alt="DayNight Vending Logo" id="logo">
      <h1>DayNight Vending</h1>
    </header>

    <!-- INVENTORY SECTION -->
    <section id="inventorySection" class="card">
      <h2>Inventory & Sales</h2>
      <table id="inventoryTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Cost</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Profit</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="restockSuggestions"></div>

      <!-- Add Stock -->
      <h3>Update Stock</h3>
      <label for="inventorySelect">Select Item:</label>
      <select id="inventorySelect"></select>
      <label for="inventoryAddQty">Quantity to Add:</label>
      <input type="number" id="inventoryAddQty" placeholder="Enter quantity">
      <button onclick="addInventoryStock()">Add Stock</button>

      <!-- Add New Item -->
      <h3>Add New Inventory Item</h3>
      <input type="text" id="newItemName" placeholder="Item Name">
      <input type="number" step="0.01" id="newItemCost" placeholder="Cost per unit">
      <input type="number" step="0.01" id="newItemPriceSingle" placeholder="Sell Price Single">
      <input type="number" step="0.01" id="newItemPriceBundle" placeholder="Sell Price Bundle">
      <input type="number" id="newItemQty" placeholder="Starting Quantity">
      <button onclick="addNewItem()">Add New Item</button>
    </section>

    <!-- Other sections: finance, routes, drivers, forms, gas, optimal routes -->
    <!-- Copy your existing sections here as before -->
  </div>

  <script src="app.js"></script>
  <script>
    // =======================
    // LOGIN FUNCTIONALITY
    // =======================
    async function login(){
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value.trim();
      if(!username || !password) return alert('Enter username and password');

      const users = await getAllData('users');
      const user = users.find(u => u.username === username && u.password === password);
      if(user){
        document.getElementById('loginPage').style.display='none';
        document.getElementById('mainApp').style.display='block';
        initializeApp(); // load app after login
      }else{
        alert('Invalid username or password');
      }
    }

    function showRegister(){
      document.getElementById('registerFields').style.display='block';
    }
    function showLogin(){
      document.getElementById('registerFields').style.display='none';
    }

    async function register(){
      const username = document.getElementById('regUsername').value.trim();
      const password = document.getElementById('regPassword').value.trim();
      if(!username || !password) return alert('Fill username and password');

      const users = await getAllData('users');
      if(users.find(u => u.username === username)) return alert('Username already exists');

      await addData('users',{username,password});
      alert('Account created! You can now log in.');
      showLogin();
    }
  </script>
</body>
</html>
